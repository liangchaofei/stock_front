<!--
 * @Author: your name
 * @Date: 2019-12-17 19:52:10
 * @LastEditTime : 2020-01-11 20:49:42
 * @LastEditors  : Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /gp/static/component/list.html
 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=0;">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>知修数据</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">
    <link rel="stylesheet" href="../css/person.css">
</head>

<body>
    <div class="person_top">
        <img src="" alt="头像" class="tx">
        <div>
            <span class="name" style="padding-bottom: 10px;">
        
            </span>
            <span>
                <svg id="is_hy" t="1578579399578" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5584" width="16" height="16"><path d="M63.904067 343.107025l2.865194-8.083941c7.367643-22.0006 26.605376-36.735885 50.038573-38.373139 21.386629-1.534926 42.773259 10.949136 52.801439 30.596183 10.232837 20.056361 7.367643 43.694214-7.469971 61.294694-1.739582 1.944239-3.479165 3.888478-5.423404 6.139702 41.44299 25.377436 82.681323 50.447886 123.715 75.722994 15.553912 9.618867 31.210153 19.237734 46.764065 28.549615 8.902568 5.218747 15.758569 3.683821 20.568002-5.01409 47.173379-85.955831 94.346757-172.01399 141.929449-258.890776-20.568002-10.437494-33.870691-26.400719-35.098631-50.038573-0.818627-16.577196 5.01409-30.800839 16.781853-42.363945 23.330868-22.716898 61.601679-20.568002 82.067353 4.604777 23.535525 28.8566 15.04227 62.624963-22.307585 88.002398 12.177076 22.307585 24.45648 44.717498 36.838213 67.025082 34.280004 62.420306 68.355351 124.635955 102.635355 187.056261 7.879285 14.4283 12.893375 15.758569 27.01469 7.367643 53.006096-32.335765 105.909863-64.876187 158.915959-97.31428 2.455881-1.534926 4.809433-3.069851 7.674628-4.809433-10.949136-10.949136-17.907465-23.330868-18.726092-38.577796-1.534926-28.549615 18.112122-53.517738 45.638453-58.224843 28.651944-5.01409 55.25732 11.358449 63.750575 39.089437 0.61397 2.148896 1.534926 4.40012 2.353553 6.549016l0 19.237734c-9.004897 28.8566-27.526332 45.638453-59.350455 45.84311-1.125612 3.274508-2.353553 6.549016-3.274508 9.823524-31.005496 106.319177-62.010992 212.84301-93.016488 319.162186-3.990806 13.916658-8.902568 17.498151-22.921555 17.498151L243.183372 754.978715c-15.04227 0-19.647047-3.479165-23.740182-17.498151-25.275107-86.262816-50.24323-172.832617-75.518337-259.095433-6.753672-23.330868-13.712002-46.661737-20.568002-70.094934-23.740182 0-41.647647-9.41421-52.801439-29.879884-2.660538-5.01409-4.40012-10.64215-6.549016-15.963226C63.904067 355.795743 63.904067 349.451384 63.904067 343.107025L63.904067 343.107025 63.904067 343.107025zM63.904067 343.107025" p-id="5585" fill="#d81e06"></path><path d="M510.362746 810.645348l250.192865 0c22.307585 0 40.112721 15.758569 42.568602 36.940542 2.455881 21.386629-11.563106 40.82902-33.154392 45.638453-3.069851 0.818627-6.344359 0.920955-9.41421 0.920955L259.965224 894.145298c-19.033077 0-35.098631-11.358449-40.624363-28.549615-5.730389-17.191166-0.409313-36.633557 14.837614-46.45708 7.879285-5.01409 18.316778-8.493255 27.526332-8.493255C344.693115 810.236035 427.579095 810.645348 510.362746 810.645348L510.362746 810.645348 510.362746 810.645348 510.362746 810.645348zM510.362746 810.645348" p-id="5586" fill="#d81e06"></path></svg>
            </span>
        </div>
    </div>

    <div>
        <!-- <div class="weui-cell">
            <div class="weui-cell__hd"><label for="name" class="weui-label">地址</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="address" type="text" value="湖北省 武汉市 武昌区" readonly="">
            </div>
        </div> -->
        <div class="weui-cell" style="margin-top: 10px;" id="member_val">
            <div class="weui-cell__hd"><label for="name" class="weui-label" style="padding-right: 10px;color: #999;
                font-size: 13px;">会员到期时间:</label>
            </div>
            <div class="weui-cell__bd">
                <div class="weui-input" id="time"></div>
                <!-- <input class="weui-input" id="phone" type="text" value=""> -->
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label for="name" class="weui-label" style="padding-right: 10px;color: #999;
                font-size: 13px;">查询剩余次数:</label>
            </div>
            <div class="weui-cell__bd">
                <div class="weui-input" id="joinTime"></div class="weui-input" id="joinTime">
                <!-- <input class="weui-input" id="joinTime" type="text" value=""> -->
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label for="name" class="weui-label" style="padding-right: 10px;color: #999;
                font-size: 13px;">经验值:</label>
            </div>
            <div class="weui-cell__bd">
                <div class="weui-input" id="exp_val"></div class="weui-input" id="joinTime">
                <!-- <input class="weui-input" id="joinTime" type="text" value=""> -->
            </div>
        </div>
        <div class="weui-cells" style="margin: 0px;">
            <a class="weui-cell weui-cell_access" href="/component/pay.html">
              <div class="weui-cell__bd">
                <p style="color: #999;
                font-size: 13px;">充值</p>
              </div>
              <div class="weui-cell__ft">
              </div>
            </a>
          </div>
    


        <div class="weui-cells"style="margin: 0px;" >
            <a class="weui-cell weui-cell_access" href="/component/feedback.html">
              <div class="weui-cell__bd">
                <p style="color: #999;
                font-size: 13px;">反馈和定制</p>
              </div>
              <div class="weui-cell__ft">
              </div>
            </a>
          </div>
          <div class="weui-panel weui-panel_access" style="margin: 0px;">
            <div class="weui-panel__hd" id="open">
                邀请记录<i class="down"></i><i class="up" style="display:none;"></i>

            </div>
            <div id="invite_dom"></div>
        </div>

        <div class="weui-panel weui-panel_access" style="margin: 0px;">
            <div class="weui-panel__hd" id="issue_open">
                我的需求<i class="down"></i><i class="up" style="display:none;"></i>

            </div>
            <div id="my_issue"></div>
        </div>

 
        <!-- <div class="weui-cell">
            <div class="weui-cell__hd"><label for="name" class="weui-label">我的条件</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="other" type="text" value="" readonly="" data-values="1,2,3">
            </div>
        </div> -->
    </div>
    <div class="weui-tabbar">
        <a href="/component/search.html" class="weui-tabbar__item">
            <div class="weui-tabbar__icon">
                <img src="../img/icon_nav_button.png" alt="">
            </div>
            <p class="weui-tabbar__label">查询</p>
        </a>
        <a href="/component/person.html" class="weui-tabbar__item weui-bar__item--on">
            <div class="weui-tabbar__icon">
                <img src="../img/icon_nav_cell.png" alt="">
            </div>
            <p class="weui-tabbar__label">我</p>
        </a>
    </div>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js">
    </script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/swiper.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/city-picker.min.js"></script>
    <script src="../js/jwerixin.js"></script>
    <script>

        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }
        $('#invite_dom').css({ "display": "none" })
        $('#open').on('click', function () {
            $('#invite_dom').slideToggle("slow");
            $("#open .up").toggle();
            $("#open .down").toggle();
        })


        $('#my_issue').css({ "display": "none" })
        $('#issue_open').on('click', function () {
            $('#my_issue').slideToggle("slow");
            $("#issue_open .up").toggle();
            $("#issue_open .down").toggle();
        })

        $.ajax({
            url: 'https://stock.zhixiutec.com/api/user',
            type: 'get',
            success: function (res) {
                var data = res.data;
                if (res.error_code === 2) {
                    window.open(data, "_self");
                } else {
                    $('.tx').attr('src', data.avatar);
                    $('.name').text(data.user_name);
                    $('#joinTime').text(data.query_left)
                    $('#time').text(data.member_expire_time.substring(0, 10))
                    $('#exp_val').text(data.exp)
                    // 获取我的需求
                    $.ajax({
                        url:'https://stock.zhixiutec.com/api/my_comments',
                        success:function(res){
                            var issue = res.data;
                            var issue_val = ''
                            if(issue.length>0){
                                issue.forEach(item => {
                                    issue_val += `
                                    <div class="weui-panel__bd" id="open_content">
                                        <div class="weui-media-box weui-media-box_small-appmsg">
                                            <div class="weui-cells">
                                                <a class="weui-cell weui-cell_access" href="javascript:;">
                                                    <div class="weui-cell__hd" style="font-size:14px;color:#333;margin-right:10px;">
                                                        ${item.CreatedAt.substring(0,10)}</div>
                                                    <div class="weui-cell__bd weui-cell_primary">
                                                        <p style="font-size:14px;color:#333">${item.response}</p>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    `
                                })
                                $('#my_issue').append(issue_val)
                            }else{

                            }
                        }
                    })
                    $.ajax({
                        url: 'https://stock.zhixiutec.com/api/is_member',
                        success: function (res) {
                            var is_member = res.data;
                            console.log('res111',is_member === false)

                            if (is_member === false) {
                                $('#member_val').css("display","none")
                                $('#is_hy').css("display","none")
                                $.ajax({
                                    url: 'https://stock.zhixiutec.com/api/payments',
                                    success: function (result) {
                                        var leader = result.data;
                                        var member = '';
                                        for (var i = 0; i < leader.length; i++) {
                                            $("#wechat").append(`<option value=${leader[i].id}>${leader[i].type_desc}</option>`);
                                        }
                                        $('#wechat').on('change', function (e) {
                                            member = parseInt(e.target.value);
                                            $('#pay_btn').on('click', function () {
                                                $.ajax({
                                                    url: 'https://stock.zhixiutec.com/api/jsapi_pay',
                                                    type: 'post',
                                                    data: JSON.stringify({ "id": member }),
                                                    success: function (res) {
                                                        console.log('res', res)
                                                        var result = res.data;
                                                        console.log('result', result)
                                                        wx.config({
                                                            debug: false,
                                                            appId: result["appId"],
                                                            timestamp: result["timeStamp"],
                                                            nonceStr: result["nonceStr"],
                                                            signature: result["signature"],
                                                            jsApiList: [
                                                                'chooseWXPay',
                                                            ]
                                                        });
                                                        wx.ready(function () {
                                                            wx.chooseWXPay({
                                                                appId: result["appId"],
                                                                timestamp: result["timeStamp"], // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符
                                                                nonceStr: result["nonceStr"], // 支付签名随机串，不长于 32 位
                                                                package: result["package"], // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=\*\*\*）
                                                                signType: result["signType"], // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'
                                                                paySign: result["sign"], // 支付签名
                                                                success: function (res) {
                                                                    console.log('res', res)
                                                                },

                                                                fail: function (res) {
                                                                    $.hideLoading()
                                                                    // alert('支付失败!');
                                                                    toast("支付失败！请检查微信配置");
                                                                },
                                                                cancel: function (res) {

                                                                    // //支付取消
                                                                    $.hideLoading()
                                                                    toast("已取消支付！");
                                                                }
                                                            });
                                                        });

                                                    }
                                                })
                                            })

                                        })

                                    }
                                })
                            }
                        }
                    })

                    // 我的邀请
                    $.ajax({
                        url: 'https://stock.zhixiutec.com/api/my_invites',
                        success: function (res) {
                            console.log('111', res)
                            var data = res.data;
                            var invite = '';
                            if (data.length > 0) {
                                data.forEach(item => {
                                    invite += `
                                    <div class="weui-panel__bd" id="open_content">
                                        <div class="weui-media-box weui-media-box_small-appmsg">
                                            <div class="weui-cells">
                                                <a class="weui-cell weui-cell_access" href="javascript:;">
                                                    <div class="weui-cell__hd"><img

                                                            src=${item.Avatar}
                                                            alt="" style="width:25px;border-radius:50%;margin-right:5px;display:block"></div>
                                                    <div class="weui-cell__bd weui-cell_primary">
                                                        <p>${item.UserName}</p>
                                                    </div>
                                                    <span>${item.CreatedAt.substring(0,10)}</span>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    `
                                })
                                $('#invite_dom').append(invite)
                            } else {
                                $('#invite_dom').append(`<div>暂无邀请，快去邀请你的小伙伴吧，赢取查询次数</div>`)
                            }
                        }
                    })
                }

            }
        })

        // $.ajax({
        //     url: 'https://stock.zhixiutec.com/api/my_conditions',
        //     type: 'get',
        //     success: function (res) {
        //         var data = res.data;
        //         var arr = [];
        //         var allConditions = [];
        //         data.map(item => {
        //             var conditions = item.conditions;
        //             var belongs = conditions.belongs;
        //             var concepts = conditions.concepts;
        //             var labels = conditions.labels;
        //             var locations = conditions.locations;
        //             var organizational_form = conditions.organizational_form;
        //             var predicts = conditions.predicts;

        //             allConditions = belongs.concat(concepts).concat(labels).concat(locations).concat(organizational_form).concat(predicts)

        //             console.log('allConditions', allConditions.join(','))
        //             arr.push(allConditions.join(','))
        //         })
        //         console.log('arr', arr)
        //         $("#other").select({
        //             title: "选择我的条件",
        //             items: arr,
        //             onClose: function (e) {
        //                 console.log('eee', e)
        //             }
        //         });
        //     }
        // })
    </script>
</body>

</html>