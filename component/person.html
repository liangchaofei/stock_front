<!--
 * @Author: your name
 * @Date: 2019-12-17 19:52:10
 * @LastEditTime : 2020-01-21 18:09:13
 * @LastEditors  : Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: /gp/static/component/list.html
 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0, user-scalable=0;">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta property="og:type" content="website" />
    <meta property="og:title" content="鉴股查询">
    <meta property="og:description" content="鉴股查询">
    <meta property="og:image" content="http://gdbaidianfeng.com/content/uploadfile/201910/42bf417d494dee2f4f49a53625ec796120191031050036.jpg">
    <title>鉴股查询</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">
    <link rel="stylesheet" href="../css/person.css">
</head>

<body>
    <div class="person_top">

        <img src="" alt="头像" class="tx">
        <div>
            <span class="name" style="padding-bottom: 10px;">

            </span>
            <span id="is_hy" style="color: red;font-size: 12px;">
                会员
            </span>
        </div>
        <div style="display: flex;margin-top: 10px;">
            <div style="flex:1">
                <p style="color: #fff;font-size: 12px;" id="time"></p>
                <p style="color: #fff;font-size: 12px;">到期时间</p>
            </div>
            <div style="flex:1">
                <p style="color: #fff;font-size: 12px;" id="joinTime"></p>
                <p style="color: #fff;font-size: 12px;">查询次数</p>
            </div>
            <div style="flex:1">
                <p style="color: #fff;font-size: 12px;" id="exp_val"></p>
                <p style="color: #fff;font-size: 12px;">经验值</p>
            </div>
        </div>
    </div>

    <div>

        <!-- <div class="weui-cell" style="margin-top: 10px;" id="member_val">
            <div class="weui-cell__hd"><label for="name" class="weui-label" style="padding-right: 10px;color: #999;
                font-size: 13px;">会员到期时间:</label>
            </div>
            <div class="weui-cell__bd">
                <div class="weui-input" id="time"></div>
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label for="name" class="weui-label" style="padding-right: 10px;color: #999;
                font-size: 13px;">查询剩余次数:</label>
            </div>
            <div class="weui-cell__bd">
                <div class="weui-input" id="joinTime"></div class="weui-input" id="joinTime">
            </div>
        </div>
        <div class="weui-cell">
            <div class="weui-cell__hd"><label for="name" class="weui-label" style="padding-right: 10px;color: #999;
                font-size: 13px;">经验值:</label>
            </div>
            <div class="weui-cell__bd">
                <div class="weui-input" id="exp_val"></div class="weui-input" id="joinTime">
            </div>
        </div> -->
        <div class="weui-cells" style="margin: 0px;">
            <a class="weui-cell weui-cell_access" href="/component/pay.html" style="padding: 12px 15px;">
                <svg style="margin-right: 10px;" t="1579525089051" class="icon" viewBox="0 0 1025 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3381" width="16" height="16"><path d="M512.011875 0C229.68778 0 0 229.68778 0 512.011875c0 282.315345 229.68778 511.988125 512.011875 511.988125s512.011875-229.67278 512.011875-511.988125C1024.025 229.68778 794.33722 0 512.011875 0zM422.954266 720.84588c-16.28377 0-29.477536-13.466266-29.477536-30.112537-0.01875-16.62127 13.193766-30.107537 29.477536-30.107537 16.26502 0 29.472536 13.486266 29.472536 30.107537C452.426802 707.359613 439.219286 720.84588 422.954266 720.84588zM641.114533 720.82588c-16.44502 0-29.795036-13.466266-29.795036-30.112537 0-16.60127 13.350016-30.087537 29.795036-30.087537 16.44002 0 29.790036 13.486266 29.790036 30.087537C670.904569 707.339613 657.579553 720.82588 641.114533 720.82588zM750.347166 501.739362c0 21.942527-17.778772 39.716298-39.721298 39.716298L399.917988 541.455661l8.656261 39.721298 281.875344 0c10.801263 0 19.541274 8.760011 19.541274 19.546274 0 10.801263-8.760011 19.541274-19.541274 19.541274L398.842987 620.264507c-0.18 0.05875-0.3225 0.2-0.497501 0.25875-6.792508 1.826252-13.486266-0.478751-18.213772-5.000006-0.653751-0.561251-1.307502-1.016251-1.888752-1.648752-0.1175-0.16125-0.215-0.3425-0.3375-0.498751-2.958754-3.411254-4.922506-7.743759-4.922506-12.651265 0-0.2975 0.15625-0.556251 0.175-0.853751l-56.025068-257.027814-23.916279 0c-10.781263 0-19.541274-8.758761-19.541274-19.540024 0-10.806263 8.760011-19.546274 19.541274-19.546274l34.185042 0 0.02 0c4.628756-1.230002 9.213761-0.478751 13.207516 1.430002 0.25875 0.1025 0.537501 0.16125 0.776251 0.27875 0.653751 0.3375 1.191251 0.796251 1.787502 1.211251 5.840007 3.358754 9.931262 9.393761 9.931262 16.62627 0 0.633751-0.2975 1.171251-0.36125 1.786252l40.077549 183.877724-1.562502-7.226259 299.487866 0c10.962513 0 19.863774-8.901261 19.863774-19.868774l0-39.721298c0-10.962513-8.901261-19.858774-19.863774-19.858774L432.569278 422.291765c-10.967513 0-19.863774-8.760011-19.863774-19.546274 0-10.805013 8.896261-19.541274 19.863774-19.541274l0-0.638751L710.625867 382.565467c21.943777 0 39.721298 17.797522 39.721298 39.726298L750.347166 501.739362z" p-id="3382" fill="#1296db"></path><path d="M512.011875 989.278708" p-id="3383" fill="#1296db"></path></svg>
                <div class="weui-cell__bd">
                    <p style="color: #999;
                font-size: 13px;">购买查询次数</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>
        <div class="weui-cells" style="margin: 0px;">
            <a class="weui-cell weui-cell_access" href="/component/buy.html" style="padding: 12px 15px;">
                <svg style="margin-right: 10px;" t="1579525456912" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3317" width="16" height="16"><path d="M160 608c-19.2 0-32 12.8-32 32v128c0 19.2 12.8 32 32 32h64c19.2 0 32-12.8 32-32v-128c0-19.2-12.8-32-32-32h-64z m0-64h64c54.4 0 96 41.6 96 96v128c0 54.4-41.6 96-96 96h-64c-54.4 0-96-41.6-96-96v-128c0-54.4 41.6-96 96-96z m320-128h64c54.4 0 96 41.6 96 96v256c0 54.4-41.6 96-96 96h-64c-54.4 0-96-41.6-96-96v-256c0-54.4 41.6-96 96-96z m0 64c-19.2 0-32 12.8-32 32v256c0 19.2 12.8 32 32 32h64c19.2 0 32-12.8 32-32v-256c0-19.2-12.8-32-32-32h-64z m320-320h64c54.4 0 96 41.6 96 96v512c0 54.4-41.6 96-96 96h-64c-54.4 0-96-41.6-96-96v-512c0-54.4 41.6-96 96-96z m0 64c-19.2 0-32 12.8-32 32v512c0 19.2 12.8 32 32 32h64c19.2 0 32-12.8 32-32v-512c0-19.2-12.8-32-32-32h-64z" p-id="3318" fill="#1296db"></path></svg>
                <div class="weui-cell__bd">
                    <p style="color: #999;
                font-size: 13px;">购买数据</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>


        <div class="weui-cells" style="margin: 0px;">
            <a class="weui-cell weui-cell_access" href="/component/feedback.html" style="padding: 12px 15px;">
                <svg style="margin-right: 10px;" t="1579525397789" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2325" width="16" height="16"><path d="M386.844 796.444L170.667 967.111V796.444H56.889V113.778H967.11v682.666H386.844z m-22.755-56.888h546.133v-568.89H113.778v568.89h113.778v108.088l136.533-108.088z" fill="#1296db" p-id="2326"></path><path d="M227.556 512h568.888v56.889H227.556V512z m0-170.667h568.888v56.89H227.556v-56.89z" fill="#1296db" p-id="2327"></path></svg>
                <div class="weui-cell__bd">
                    <p style="color: #999;
                font-size: 13px;">反馈建议</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>

        <!-- <div class="weui-cells" style="margin: 0px;">
            <a class="weui-cell weui-cell_access" href="/component/invite.html">
                <div class="weui-cell__bd">
                    <p style="color: #999;
                font-size: 13px;">邀请记录</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div> -->
        <div class="weui-cells" style="margin: 0px;">
            <a class="weui-cell weui-cell_access" href="/component/xq.html" style="padding: 12px 15px;">
                <svg style="margin-right: 10px;" t="1579525550265" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1390" width="16" height="16"><path d="M318.7 633.9H82.6c-10.8 0-19.5 8.7-19.5 19.5v236.1c0 10.8 8.7 19.5 19.5 19.5h236.1c10.8 0 19.5-8.7 19.5-19.5V653.4c0-10.8-8.8-19.5-19.5-19.5z m-19.6 236h-197v-197h197v197zM941.4 668.1H446.1c-10.8 0-19.5 8.7-19.5 19.5s8.7 19.5 19.5 19.5h495.3c10.8 0 19.5-8.7 19.5-19.5s-8.7-19.5-19.5-19.5zM941.4 835.7H446.1c-10.8 0-19.5 8.7-19.5 19.5s8.7 19.5 19.5 19.5h495.3c10.8 0 19.5-8.7 19.5-19.5s-8.7-19.5-19.5-19.5zM318.7 115H82.6c-10.8 0-19.5 8.7-19.5 19.5v236.1c0 10.8 8.7 19.5 19.5 19.5h236.1c10.8 0 19.5-8.7 19.5-19.5V134.5c0-10.8-8.8-19.5-19.5-19.5z m-19.6 236.1h-197v-197h197v197zM446.1 188.3h495.3c10.8 0 19.5-8.7 19.5-19.5s-8.7-19.5-19.5-19.5H446.1c-10.8 0-19.5 8.7-19.5 19.5s8.7 19.5 19.5 19.5zM941.4 316.8H446.1c-10.8 0-19.5 8.7-19.5 19.5s8.7 19.5 19.5 19.5h495.3c10.8 0 19.5-8.7 19.5-19.5s-8.7-19.5-19.5-19.5z" fill="#1296db" p-id="1391"></path></svg>
                <div class="weui-cell__bd">
                    <p style="color: #999;
                font-size: 13px;">我的建议</p>
                </div>
                <div class="weui-cell__ft">
                </div>
            </a>
        </div>


        <!-- <button id="share_btn" style="margin-bottom: 50px;">分享</button> -->
        <!-- 
          <div class="weui-panel weui-panel_access" style="margin: 0px;">
            <div class="weui-panel__hd" id="open">
                邀请记录<i class="down"></i><i class="up" style="display:none;"></i>

            </div>
            <div id="invite_dom"></div>
        </div> -->

        <!-- <div class="weui-panel weui-panel_access" style="margin: 0px;">
            <div class="weui-panel__hd" id="issue_open">
                我的需求<i class="down"></i><i class="up" style="display:none;"></i>

            </div>
            <div id="my_issue"></div>
        </div> -->


        <!-- <div class="weui-cell">
            <div class="weui-cell__hd"><label for="name" class="weui-label">我的条件</label></div>
            <div class="weui-cell__bd">
                <input class="weui-input" id="other" type="text" value="" readonly="" data-values="1,2,3">
            </div>
        </div> -->
    </div>
    <div class="weui-tabbar">
        <a href="/component/search.html" class="weui-tabbar__item">
            <div class="weui-tabbar__icon">
                <img src="../img/icon_nav_button.png" alt="">
            </div>
            <p class="weui-tabbar__label">查询</p>
        </a>
        <a href="/component/person.html" class="weui-tabbar__item weui-bar__item--on">
            <div class="weui-tabbar__icon">
                <img src="../img/icon_nav_cell.png" alt="">
            </div>
            <p class="weui-tabbar__label">个人中心</p>
        </a>
    </div>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js">
    </script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/swiper.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/city-picker.min.js"></script>
    <script src="../js/qecode.js"></script>
    <!-- <script src="../js/jwerixin.js"></script> -->
    <script src="http://res.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
    <script>


        function getUrlParam(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg);  //匹配目标参数
            if (r != null) return unescape(r[2]); return null; //返回参数值
        }
        $('#invite_dom').css({ "display": "none" })
        $('#open').on('click', function () {
            $('#invite_dom').slideToggle("slow");
            $("#open .up").toggle();
            $("#open .down").toggle();
        })


        $('#my_issue').css({ "display": "none" })
        $('#issue_open').on('click', function () {
            $('#my_issue').slideToggle("slow");
            $("#issue_open .up").toggle();
            $("#issue_open .down").toggle();
        })
     
        $.ajax({
            url: 'https://stock.zhixiutec.com/api/user',
            type: 'get',
            success: function (res) {
                var data = res.data;
                if (res.error_code === 2) {
                    window.open(data, "_self");
                } else {
                    $('.tx').attr('src', data.avatar);
                    $('.name').text(data.user_name);
                    $('#joinTime').text(data.query_left)
                    $('#time').text(data.member_expire_time.substring(0, 10))
                    $('#exp_val').text(data.exp)
                }

            }
        })
        // 获取我的需求
        $.ajax({
            url: `https://stock.zhixiutec.com/api/my_comments`,
            success: function (res) {
                var issue = res.data;
                var issue_val = ''
                if (issue.length > 0) {
                    issue.forEach(item => {
                        issue_val += `
                                    <div class="weui-panel__bd" id="open_content">
                                        <div class="weui-media-box weui-media-box_small-appmsg">
                                            <div class="weui-cells">
                                                <a class="weui-cell weui-cell_access" href="javascript:;">
                                                    <div class="weui-cell__hd" style="font-size:14px;color:#333;margin-right:10px;">
                                                        ${item.CreatedAt.substring(0, 10)}:</div>
                                                    <div class="weui-cell__bd weui-cell_primary">
                                                        <p style="font-size:14px;color:#333">${item.content}</p>
                                                        <p style="font-size:14px;color:#333">${item.response}</p>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    `
                    })
                    $('#my_issue').append(issue_val)
                } else {

                }
            }
        })
        $.ajax({
            url: `https://stock.zhixiutec.com/api/is_member`,
            success: function (res) {
                var is_member = res.data;

                if (is_member === false) {
                    $('#member_val').css("display", "none")
                    $('#is_hy').css("display", "none")
                    $.ajax({
                        url: 'https://stock.zhixiutec.com/api/payments',
                        success: function (result) {
                            var leader = result.data;
                            var member = '';
                            for (var i = 0; i < leader.length; i++) {
                                $("#wechat").append(`<option value=${leader[i].id}>${leader[i].type_desc}</option>`);
                            }
                            $('#wechat').on('change', function (e) {
                                member = parseInt(e.target.value);
                                $('#pay_btn').on('click', function () {
                                    $.ajax({
                                        url: 'https://stock.zhixiutec.com/api/jsapi_pay',
                                        type: 'post',
                                        data: JSON.stringify({ "id": member }),
                                        success: function (res) {
                                            var result = res.data;
                                            wx.config({
                                                debug: false,
                                                appId: result["appId"],
                                                timestamp: result["timeStamp"],
                                                nonceStr: result["nonceStr"],
                                                signature: result["signature"],
                                                jsApiList: [
                                                    'chooseWXPay',
                                                ]
                                            });
                                            wx.ready(function () {
                                                wx.chooseWXPay({
                                                    appId: result["appId"],
                                                    timestamp: result["timeStamp"], // 支付签名时间戳，注意微信jssdk中的所有使用timestamp字段均为小写。但最新版的支付后台生成签名使用的timeStamp字段名需大写其中的S字符
                                                    nonceStr: result["nonceStr"], // 支付签名随机串，不长于 32 位
                                                    package: result["package"], // 统一支付接口返回的prepay_id参数值，提交格式如：prepay_id=\*\*\*）
                                                    signType: result["signType"], // 签名方式，默认为'SHA1'，使用新版支付需传入'MD5'
                                                    paySign: result["sign"], // 支付签名
                                                    success: function (res) {
                                                    },

                                                    fail: function (res) {
                                                        $.hideLoading()
                                                        // alert('支付失败!');
                                                        toast("支付失败！请检查微信配置");
                                                    },
                                                    cancel: function (res) {

                                                        // //支付取消
                                                        $.hideLoading()
                                                        toast("已取消支付！");
                                                    }
                                                });
                                            });

                                        }
                                    })
                                })

                            })

                        }
                    })
                }
            }
        })
    </script>
</body>

</html>